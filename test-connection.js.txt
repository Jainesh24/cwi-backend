require('dotenv').config();
const { MongoClient } = require('mongodb');

const uri = process.env.MONGODB_URI;

console.log('ğŸ” Connection String (first 50 chars):', uri?.substring(0, 50));

async function test() {
    const client = new MongoClient(uri, {
        family: 4, // Force IPv4
        serverSelectionTimeoutMS: 10000,
    });

    try {
        console.log('ğŸ” Attempting connection...');
        await client.connect();
        console.log('âœ… Connected successfully!');
        
        const db = client.db();
        console.log('ğŸ“Š Database name:', db.databaseName);
        
        const collections = await db.listCollections().toArray();
        console.log('ğŸ“‚ Collections found:', collections.length);
        collections.forEach(c => console.log('  -', c.name));
        
    } catch (err) {
        console.error('âŒ Connection failed');
        console.error('Error name:', err.name);
        console.error('Error message:', err.message);
        if (err.cause) {
            console.error('Cause:', err.cause);
        }
    } finally {
        await client.close();
        console.log('ğŸ”Œ Connection closed');
    }
}

test();